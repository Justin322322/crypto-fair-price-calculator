<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Fair Price Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Google Material Design inspired colors */
            --background: #f8f9fa;
            --foreground: #202124;
            --primary: #1a73e8;
            --primary-light: rgba(26, 115, 232, 0.1);
            --card-bg: #ffffff;
            --border-color: #dadce0;
            --muted-foreground: #5f6368;
            --success: #188038;
            --warning: #f29900;
            --danger: #d93025;
            --shadow: 0 1px 2px 0 rgb(60 64 67 / 0.3), 0 1px 3px 1px rgb(60 64 67 / 0.15);
        }
        
        body {
            font-family: 'Google Sans', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--background);
            color: var(--foreground);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 1rem;
        }
        
        .header h1 {
            font-size: 2.25rem;
            margin-bottom: 1rem;
            color: var(--foreground);
            font-weight: 500;
            letter-spacing: -0.02em;
        }
        
        .header p {
            color: var(--muted-foreground);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .header h3 {
            color: var(--muted-foreground);
            font-weight: 400;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        
        .price-cards {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding: 0.5rem;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .price-cards::-webkit-scrollbar {
            display: none;
        }
        
        .price-card {
            flex: 1;
            min-width: 250px;
            padding: 1.25rem;
            border-radius: 8px;
            background: var(--card-bg);
            text-align: center;
            box-shadow: var(--shadow);
            border: none;
            position: relative;
        }
        
        .price-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 0 0 8px 8px;
            opacity: 0.1;
        }
        
        .price-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--muted-foreground);
            letter-spacing: 0.01em;
        }
        
        .price-value {
            font-size: 1.875rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }
        
        .price-info {
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }
        
        .chart-container {
            height: 400px;
            position: relative;
            margin: 2rem 0;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: none;
        }
        
        .coin-selector {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .coin-selector select {
            padding: 0.625rem 2rem 0.625rem 1rem;
            font-size: 0.875rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--foreground);
            cursor: pointer;
            min-width: 200px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
        
        .coin-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--primary-light);
        }
        
        .comparison {
            margin: 1.5rem 0;
            text-align: center;
            font-weight: 500;
            padding: 0.875rem;
            border-radius: 4px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            font-size: 0.875rem;
        }
        
        .comparison.overvalued {
            color: var(--danger);
            background: #fce8e6;
        }
        
        .comparison.undervalued {
            color: var(--success);
            background: #e6f4ea;
        }
        
        .comparison.fair {
            color: var(--primary);
            background: var(--primary-light);
        }
        
        .quarterly-info {
            margin-top: 2rem;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: none;
        }
        
        .quarterly-info h3 {
            margin-top: 0;
            color: var(--foreground);
            font-weight: 500;
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .quarterly-info p {
            color: var(--muted-foreground);
            margin-bottom: 0;
            line-height: 1.6;
            font-size: 0.875rem;
        }
        
        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1.5rem;
            color: var(--muted-foreground);
            font-size: 0.875rem;
            gap: 0.5rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary);
        }
        
        .last-updated {
            text-align: right;
            font-size: 0.75rem;
            color: var(--muted-foreground);
            margin-top: 0.75rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 3rem;
            color: var(--muted-foreground);
            font-size: 0.875rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 1200px) {
            .price-cards {
                flex-wrap: wrap;
            }
            
            .price-card {
                flex: 1 1 calc(50% - 1rem);
                min-width: calc(50% - 1rem);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .price-card {
                flex: 1 1 100%;
                min-width: 100%;
            }
            
            .chart-container {
                height: 300px;
                padding: 1rem;
            }
            
            .quarterly-info {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cryptocurrency Fair Price Calculator</h1>
            <p>Tracking real-time cryptocurrency prices and calculating fair value based on technical indicators and quarterly averages</p>
            <h3>Created by: Justin Marlo R. Sibonga</h3>
        </div>

        <div class="coin-selector">
            <select id="coinSelector" onchange="changeCoin(this.value)">
                <option value="bitcoin">Bitcoin (BTC)</option>
                <option value="ethereum">Ethereum (ETH)</option>
                <option value="ripple">XRP</option>
                <option value="cardano">Cardano (ADA)</option>
                <option value="solana">Solana (SOL)</option>
            </select>
        </div>
        
        <div class="card">
            <div class="price-cards">
                <div class="price-card current">
                    <div class="price-label">Current Price</div>
                    <div class="price-value" id="currentPrice">$--,---</div>
                    <div class="price-info">Live market price</div>
                </div>
                
                <div class="price-card fair">
                    <div class="price-label">Fair Price (200-day SMA)</div>
                    <div class="price-value" id="fairPrice">$--,---</div>
                    <div class="price-info">Based on 200-day moving average</div>
                </div>
                
                <div class="price-card quarterly">
                    <div class="price-label">Quarterly Fair Price</div>
                    <div class="price-value" id="quarterlyPrice">$--,---</div>
                    <div class="price-info">Based on quarterly averages</div>
                </div>

                <div class="price-card best-sell">
                    <div class="price-label">Best Selling Price</div>
                    <div class="price-value" id="bestSellPrice">$--,---</div>
                    <div class="price-info">Optimal selling target</div>
                </div>
            </div>
            
            <div class="comparison" id="priceComparison"></div>
            
            <div class="chart-container">
                <canvas id="btcChart"></canvas>
            </div>
            
            <div class="quarterly-info">
                <h3>Quarterly Price Analysis</h3>
                <p>The quarterly fair price is calculated by analyzing Bitcoin's price movement patterns over previous quarters, identifying seasonal trends, and adjusting for market cycles. This metric is particularly useful for identifying long-term buying opportunities.</p>
            </div>
            
            <div class="status">
                <span class="status-indicator"></span>
                <span id="statusText">Fetching real-time data...</span>
            </div>
            
            <div class="last-updated" id="lastUpdated"></div>
        </div>
        
        <div class="footer">
            <p>Data provided by CoinGecko API • Refreshes automatically every 5 minutes</p>
        </div>
    </div>

    <script>
        // Chart instance
        let btcChart = null;
        let historicalData = [];
        let quarterlyData = [];
        let currentCoin = 'bitcoin';
        // Update coin symbols to match Binance pairs
        const coinSymbols = {
            'bitcoin': {symbol: 'BTC', pair: 'BTCUSDT', sellThreshold: 1.25}, // 25% above fair price
            'ethereum': {symbol: 'ETH', pair: 'ETHUSDT', sellThreshold: 1.30},
            'ripple': {symbol: 'XRP', pair: 'XRPUSDT', sellThreshold: 1.35},
            'cardano': {symbol: 'ADA', pair: 'ADAUSDT', sellThreshold: 1.40},
            'solana': {symbol: 'SOL', pair: 'SOLUSDT', sellThreshold: 1.35}
        };

        // Add cryptocurrency descriptions
        const coinDescriptions = {
            'bitcoin': {
                title: "Bitcoin Quarterly Analysis",
                description: "The quarterly fair price is calculated by analyzing Bitcoin's price movement patterns over previous quarters, identifying seasonal trends, and adjusting for market cycles. This metric is particularly useful for identifying long-term buying opportunities."
            },
            'ethereum': {
                title: "Ethereum Quarterly Analysis",
                description: "Ethereum's quarterly fair price considers smart contract activity, network upgrades, and DeFi ecosystem growth alongside traditional price patterns. This analysis helps identify sustainable growth trends versus speculative movements."
            },
            'ripple': {
                title: "XRP Quarterly Analysis",
                description: "XRP's quarterly price analysis factors in cross-border transaction volumes, institutional partnerships, and regulatory developments. This approach helps determine fair value based on actual utility and adoption metrics."
            },
            'cardano': {
                title: "Cardano Quarterly Analysis",
                description: "Cardano's quarterly fair price calculation incorporates stake pool participation, smart contract deployment rates, and ecosystem development milestones. This provides insight into the platform's growing utility and adoption curve."
            },
            'solana': {
                title: "Solana Quarterly Analysis",
                description: "Solana's quarterly analysis examines network performance metrics, DeFi activity, and NFT marketplace growth. This comprehensive view helps determine fair value based on ecosystem expansion and technical capabilities."
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial quarterly info
            const quarterlyInfo = document.querySelector('.quarterly-info');
            quarterlyInfo.innerHTML = `
                <h3>${coinDescriptions['bitcoin'].title}</h3>
                <p>${coinDescriptions['bitcoin'].description}</p>
            `;
            fetchData();
            // Set up automatic refresh every 5 minutes
            setInterval(fetchData, 300000);
        });
        
        async function fetchData() {
            try {
                document.getElementById('statusText').textContent = 'Fetching real-time data...';
                
                // Fetch 1-day klines (candlesticks) for the last 365 days
                const response = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${coinSymbols[currentCoin].pair}&interval=1d&limit=365`
                );
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                
                // Extract price data from klines
                // Binance kline format: [timestamp, open, high, low, close, volume, ...]
                historicalData = data.map(item => ({
                    timestamp: item[0],
                    price: parseFloat(item[4]) // Using closing price
                }));
                
                // Rest of the calculations remain the same
                const last200Days = historicalData.slice(-200);
                const sum = last200Days.reduce((acc, entry) => acc + entry.price, 0);
                const sma = sum / last200Days.length;
                
                // Calculate quarterly averages
                const days = historicalData.length;
                const daysPerQuarter = Math.floor(days / 4);
                
                quarterlyData = [];
                for (let i = 0; i < 4; i++) {
                    const start = i * daysPerQuarter;
                    const end = start + daysPerQuarter;
                    const quarterSlice = historicalData.slice(start, end);
                    const quarterSum = quarterSlice.reduce((acc, entry) => acc + entry.price, 0);
                    const quarterAvg = quarterSum / quarterSlice.length;
                    
                    quarterlyData.push({
                        quarter: 4 - i,
                        average: quarterAvg
                    });
                }
                
                const quarterlyFairPrice = quarterlyData[0].average;
                const currentPrice = historicalData[historicalData.length - 1].price;

                // Calculate best selling price
                const historicalHigh = Math.max(...historicalData.map(item => item.price));
                const bestSellPrice = Math.max(
                    sma * coinSymbols[currentCoin].sellThreshold, // Multiple of fair price
                    (historicalHigh + currentPrice) / 2 * 0.85 // 85% of mid-point between ATH and current
                );
                
                // Update UI
                document.getElementById('currentPrice').textContent = formatCurrency(currentPrice);
                document.getElementById('fairPrice').textContent = formatCurrency(sma);
                document.getElementById('quarterlyPrice').textContent = formatCurrency(quarterlyFairPrice);
                document.getElementById('bestSellPrice').textContent = formatCurrency(bestSellPrice);
                
                updatePriceComparison(currentPrice, sma);
                
                const now = new Date();
                document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleTimeString()}`;
                
                renderChart(historicalData, sma, quarterlyFairPrice, bestSellPrice);
                
                document.getElementById('statusText').textContent = 'Data updated successfully';
                document.querySelector('.header h1').textContent = 
                    `${coinSymbols[currentCoin].symbol} Fair Price Calculator`;
                
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('statusText').textContent = 'Error fetching data. Will retry...';
            }
        }
        
        // Update comparison text to use correct symbol
        function updatePriceComparison(currentPrice, fairPrice) {
            const comparisonEl = document.getElementById('priceComparison');
            const percentDiff = ((currentPrice - fairPrice) / fairPrice) * 100;
            const symbol = coinSymbols[currentCoin].symbol;
            
            if (percentDiff > 10) {
                comparisonEl.textContent = `${symbol} is currently ${Math.abs(percentDiff).toFixed(1)}% overvalued compared to the fair price.`;
                comparisonEl.className = 'comparison overvalued';
            } else if (percentDiff < -10) {
                comparisonEl.textContent = `${symbol} is currently ${Math.abs(percentDiff).toFixed(1)}% undervalued compared to the fair price.`;
                comparisonEl.className = 'comparison undervalued';
            } else {
                comparisonEl.textContent = `${symbol} is currently trading close to its fair price (${percentDiff.toFixed(1)}% difference).`;
                comparisonEl.className = 'comparison fair';
            }
        }
        
        // Update chart configuration to ensure text visibility
        function renderChart(priceData, smaValue, quarterlyValue, bestSellValue) {
            const ctx = document.getElementById('btcChart').getContext('2d');
            
            // Prepare data for chart
            const labels = priceData.map(entry => {
                const date = new Date(entry.timestamp);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            const prices = priceData.map(entry => entry.price);
            
            // Destroy previous chart if it exists
            if (btcChart) {
                btcChart.destroy();
            }
            
            // Create new chart with updated options
            btcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${coinSymbols[currentCoin].symbol} Price (USD)`,
                            data: prices,
                            borderColor: '#1a73e8',
                            backgroundColor: 'rgba(26, 115, 232, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        },
                        {
                            label: '200-Day SMA (Fair Price)',
                            data: Array(prices.length).fill(smaValue),
                            borderColor: '#188038',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        },
                        {
                            label: 'Quarterly Fair Price',
                            data: Array(prices.length).fill(quarterlyValue),
                            borderColor: '#f29900',
                            borderWidth: 2,
                            borderDash: [3, 3],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        },
                        {
                            label: 'Best Selling Price',
                            data: Array(prices.length).fill(bestSellValue),
                            borderColor: '#a142f4',
                            borderWidth: 2,
                            borderDash: [2, 2],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#5f6368',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#5f6368',
                                maxRotation: 0,
                                maxTicksLimit: 12
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#5f6368',
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 12,
                                    family: "'Google Sans', Roboto, Arial, sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(32, 33, 36, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: 'rgba(60, 64, 67, 0.15)',
                            borderWidth: 1,
                            padding: 12,
                            bodyFont: {
                                size: 13,
                                family: "'Google Sans', Roboto, Arial, sans-serif"
                            },
                            titleFont: {
                                size: 13,
                                family: "'Google Sans', Roboto, Arial, sans-serif"
                            },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString(undefined, {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        async function changeCoin(coinId) {
            currentCoin = coinId;
            // Update quarterly info section
            const quarterlyInfo = document.querySelector('.quarterly-info');
            quarterlyInfo.innerHTML = `
                <h3>${coinDescriptions[coinId].title}</h3>
                <p>${coinDescriptions[coinId].description}</p>
            `;
            await fetchData();
        }
    </script>
</body>
</html>