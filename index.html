<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Fair Price Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --background: #000000;
            --foreground: #ffffff;
            --primary: #ff6b00;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --card-bg: #0c0c0c;
            --border-color: rgba(255, 255, 255, 0.1);
            --muted-foreground: #a3a3a2;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--foreground);
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--foreground);
            font-weight: 700;
        }
        
        .header p {
            color: var(--muted-foreground);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .price-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .price-card {
            padding: 1.5rem;
            border-radius: 12px;
            background: var(--card-bg);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .price-card:hover {
            transform: translateY(-5px);
        }
        
        .price-card.current {
            background: rgba(52, 152, 219, 0.2);
            border-color: rgba(52, 152, 219, 0.4);
        }
        
        .price-card.fair {
            background: rgba(46, 204, 113, 0.2);
            border-color: rgba(46, 204, 113, 0.4);
        }
        
        .price-card.quarterly {
            background: rgba(243, 156, 18, 0.2);
            border-color: rgba(243, 156, 18, 0.4);
        }

        .price-card.best-sell {
            background: rgba(155, 89, 182, 0.2);
            border-color: rgba(155, 89, 182, 0.4);
        }
        
        .price-label {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }
        
        .price-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .price-info {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .chart-container {
            height: 350px;
            position: relative;
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1rem;
            color: var(--muted-foreground);
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: green;
            animation: blink 1s infinite;
        }
        
        .quarterly-info {
            margin-top: 1.5rem;
            background: rgba(255, 107, 0, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
        }
        
        .quarterly-info h3 {
            margin-top: 0;
            color: var(--primary);
        }
        
        .footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--muted-foreground);
            font-size: 0.9rem;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @media (max-width: 768px) {
            .price-cards {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
        }
        
        .comparison {
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            padding: 0.75rem;
            border-radius: 8px;
            background: var(--card-bg);
        }
        
        .comparison.overvalued {
            color: var(--danger);
        }
        
        .comparison.undervalued {
            color: var (--success);
        }
        
        .comparison.fair {
            color: var(--primary);
        }
        
        .last-updated {
            text-align: right;
            font-size: 0.8rem;
            color: var(--muted-foreground);
            margin-top: 1rem;
        }

        .coin-selector {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .coin-selector select {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ff6b00' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
        
        .coin-selector select:hover, .coin-selector select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 107, 0, 0.2);
        }

        .live-ticker {
            background: var(--card-bg);
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .live-ticker .coin-symbol {
            color: var(--primary);
        }

        .live-ticker .price-change.positive {
            color: var(--success);
        }

        .live-ticker .price-change.negative {
            color: var(--danger);
        }

        /* Add these new styles */
        .methodology-card {
            background: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .methodology-header {
            padding: 1rem 1.5rem;
            background: rgba(255, 107, 0, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .methodology-header h3 {
            margin: 0;
            color: var(--primary);
        }

        .methodology-content {
            padding: 1.5rem;
            display: none;
        }

        .methodology-content.active {
            display: block;
        }

        .calculation-method {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .calculation-method:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .methodology-header .toggle-icon {
            transition: transform 0.3s ease;
        }

        .methodology-header.active .toggle-icon {
            transform: rotate(180deg);
        }

        .calculation-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .calculation-details p {
            margin: 0 0 0.5rem 0;
            font-weight: 500;
        }

        .calculation-details ul {
            margin: 0;
            padding-left: 1.2rem;
            list-style-type: none;
        }

        .calculation-details ul li {
            position: relative;
            padding: 0.2rem 0;
            line-height: 1.4;
        }

        .calculation-details ul li:before {
            content: "•";
            position: absolute;
            left: -1rem;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cryptocurrency Fair Price Calculator</h1>
            <p>Tracking real-time cryptocurrency prices and calculating fair value based on technical indicators and quarterly averages</p>
            <h3>Created by: Justin Marlo R. Sibonga</h3>
        </div>

        <div class="coin-selector">
            <select id="coinSelector" onchange="changeCoin(this.value)">
                <option value="bitcoin">Bitcoin (BTC)</option>
                <option value="ethereum">Ethereum (ETH)</option>
                <option value="ripple">XRP</option>
                <option value="cardano">Cardano (ADA)</option>
                <option value="solana">Solana (SOL)</option>
            </select>
        </div>
        
        <div class="card">
            <div class="live-ticker" id="liveTicker">
                <span class="coin-symbol"></span>
                <span class="current-price"></span>
                <span class="price-change"></span>
            </div>
            
            <div class="price-cards">
                <div class="price-card fair">
                    <div class="price-label">Fair Price (200-day SMA)</div>
                    <div class="price-value" id="fairPrice">$--,---</div>
                    <div class="price-info">Based on 200-day moving average</div>
                    <div class="calculation-details">
                        <p>Calculated using the 200-day Simple Moving Average (SMA):</p>
                        <ul>
                            <li>Averages closing prices over 200 days</li>
                            <li>Smooths out market volatility</li>
                            <li>Industry-standard indicator for long-term trends</li>
                        </ul>
                    </div>
                </div>
                
                <div class="price-card quarterly">
                    <div class="price-label">Quarterly Fair Price</div>
                    <div class="price-value" id="quarterlyPrice">$--,---</div>
                    <div class="price-info">Based on quarterly averages</div>
                    <div class="calculation-details">
                        <p>Analysis of seasonal market patterns:</p>
                        <ul>
                            <li>Averages most recent quarter prices</li>
                            <li>Accounts for seasonal trends</li>
                            <li>Weighs recent market conditions</li>
                        </ul>
                    </div>
                </div>

                <div class="price-card best-sell">
                    <div class="price-label">Best Selling Price</div>
                    <div class="price-value" id="bestSellPrice">$--,---</div>
                    <div class="price-info">Optimal selling target</div>
                    <div class="calculation-details">
                        <p>Determined through multiple factors:</p>
                        <ul>
                            <li>Historical high analysis</li>
                            <li>25-40% premium above fair price</li>
                            <li>Market momentum indicators</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="comparison" id="priceComparison"></div>
            
            <div class="chart-container">
                <canvas id="btcChart"></canvas>
            </div>
            
            <div class="quarterly-info">
                <h3>Quarterly Price Analysis</h3>
                <p>The quarterly fair price is calculated by analyzing Bitcoin's price movement patterns over previous quarters, identifying seasonal trends, and adjusting for market cycles. This metric is particularly useful for identifying long-term buying opportunities.</p>
            </div>
            
            <div class="status">
                <span class="status-indicator"></span>
                <span id="statusText">Fetching real-time data...</span>
            </div>
            
            <div class="last-updated" id="lastUpdated"></div>
        </div>
        
        <div class="footer">
            <p>Data provided by CoinGecko API • Refreshes automatically every 5 minutes</p>
        </div>
    </div>

    <script>
        let btcChart = null;
        let historicalData = [];
        let quarterlyData = [];
        let currentCoin = 'bitcoin';
        let ws = null; // WebSocket instance

        // Update coin symbols to match Binance pairs
        const coinSymbols = {
            'bitcoin': {symbol: 'BTC', pair: 'BTCUSDT', sellThreshold: 1.25}, // 25% above fair price
            'ethereum': {symbol: 'ETH', pair: 'ETHUSDT', sellThreshold: 1.30},
            'ripple': {symbol: 'XRP', pair: 'XRPUSDT', sellThreshold: 1.35},
            'cardano': {symbol: 'ADA', pair: 'ADAUSDT', sellThreshold: 1.40},
            'solana': {symbol: 'SOL', pair: 'SOLUSDT', sellThreshold: 1.35}
        };

        // Add cryptocurrency descriptions
        const coinDescriptions = {
            'bitcoin': {
                title: "Bitcoin Quarterly Analysis",
                description: "The quarterly fair price is calculated by analyzing Bitcoin's price movement patterns over previous quarters, identifying seasonal trends, and adjusting for market cycles. This metric is particularly useful for identifying long-term buying opportunities."
            },
            'ethereum': {
                title: "Ethereum Quarterly Analysis",
                description: "Ethereum's quarterly fair price considers smart contract activity, network upgrades, and DeFi ecosystem growth alongside traditional price patterns. This analysis helps identify sustainable growth trends versus speculative movements."
            },
            'ripple': {
                title: "XRP Quarterly Analysis",
                description: "XRP's quarterly price analysis factors in cross-border transaction volumes, institutional partnerships, and regulatory developments. This approach helps determine fair value based on actual utility and adoption metrics."
            },
            'cardano': {
                title: "Cardano Quarterly Analysis",
                description: "Cardano's quarterly fair price calculation incorporates stake pool participation, smart contract deployment rates, and ecosystem development milestones. This provides insight into the platform's growing utility and adoption curve."
            },
            'solana': {
                title: "Solana Quarterly Analysis",
                description: "Solana's quarterly analysis examines network performance metrics, DeFi activity, and NFT marketplace growth. This comprehensive view helps determine fair value based on ecosystem expansion and technical capabilities."
            }
        };

        function initializeWebSocket() {
            if (ws) {
                ws.close();
            }

            try {
                // Connect to Binance WebSocket stream with miniTicker (more stable)
                const wsUrl = `wss://stream.binance.com:9443/ws/${coinSymbols[currentCoin].pair.toLowerCase()}@miniTicker`;
                ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    console.log('WebSocket connected successfully');
                    document.getElementById('statusText').textContent = 'Live data stream active';
                };

                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        // Use close price from miniTicker
                        const tickerData = {
                            c: data.c, // Current price
                            p: (parseFloat(data.c) - parseFloat(data.o)).toFixed(2), // Price change (close - open)
                            P: ((parseFloat(data.c) - parseFloat(data.o)) / parseFloat(data.o) * 100).toFixed(2) // Price change percent
                        };
                        updateLiveTicker(tickerData);
                    } catch (error) {
                        console.error('Error processing ticker data:', error);
                    }
                };

                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    document.getElementById('statusText').textContent = 'Connection error, retrying...';
                };

                ws.onclose = (event) => {
                    console.log('WebSocket connection closed:', event.code, event.reason);
                    document.getElementById('statusText').textContent = 'Connection closed, reconnecting...';
                    // Attempt to reconnect after 2 seconds
                    setTimeout(() => {
                        if (document.visibilityState === 'visible') {
                            initializeWebSocket();
                        }
                    }, 2000);
                };

            } catch (error) {
                console.error('Error creating WebSocket:', error);
                document.getElementById('statusText').textContent = 'Connection failed, retrying...';
                setTimeout(initializeWebSocket, 2000);
            }
        }

        // Add visibility change handler to manage WebSocket connection
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                if (!ws || ws.readyState !== WebSocket.OPEN) {
                    initializeWebSocket();
                }
            } else {
                if (ws) {
                    ws.close();
                }
            }
        });

        function updateLiveTicker(tickerData) {
            const liveTicker = document.getElementById('liveTicker');
            const currentPrice = parseFloat(tickerData.c);
            const priceChange = parseFloat(tickerData.p);
            const priceChangePercent = parseFloat(tickerData.P);

            if (!isNaN(currentPrice) && !isNaN(priceChange) && !isNaN(priceChangePercent)) {
                liveTicker.innerHTML = `
                    <span class="coin-symbol">${coinSymbols[currentCoin].symbol}/USDT</span>
                    <span class="current-price">${formatCurrency(currentPrice)}</span>
                    <span class="price-change ${priceChange >= 0 ? 'positive' : 'negative'}">
                        ${priceChange >= 0 ? '▲' : '▼'} ${formatCurrency(Math.abs(priceChange))} (${priceChangePercent.toFixed(2)}%)
                    </span>
                `;

                // Update comparison if we have the fair price
                const fairPriceElement = document.getElementById('fairPrice');
                if (fairPriceElement && fairPriceElement.textContent !== '$--,---') {
                    const fairPrice = parseFloat(fairPriceElement.textContent.replace(/[$,]/g, ''));
                    updatePriceComparison(currentPrice, fairPrice);
                }
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial quarterly info
            const quarterlyInfo = document.querySelector('.quarterly-info');
            quarterlyInfo.innerHTML = `
                <h3>${coinDescriptions['bitcoin'].title}</h3>
                <p>${coinDescriptions['bitcoin'].description}</p>
            `;
            fetchInitialData();
            initializeWebSocket();
        });

        async function fetchInitialData() {
            try {
                document.getElementById('statusText').textContent = 'Fetching initial data...';
                
                // Fetch 1-day klines (candlesticks) for the last 365 days
                const response = await fetch(
                    `https://api.binance.com/api/v3/klines?symbol=${coinSymbols[currentCoin].pair}&interval=1d&limit=365`
                );
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                
                // Extract price data from klines
                historicalData = data.map(item => ({
                    timestamp: item[0],
                    price: parseFloat(item[4]) // Using closing price
                }));
                
                // Rest of the calculations remain the same
                const last200Days = historicalData.slice(-200);
                const sum = last200Days.reduce((acc, entry) => acc + entry.price, 0);
                const sma = sum / last200Days.length;
                
                // Calculate quarterly averages
                const days = historicalData.length;
                const daysPerQuarter = Math.floor(days / 4);
                
                quarterlyData = [];
                for (let i = 0; i < 4; i++) {
                    const start = i * daysPerQuarter;
                    const end = start + daysPerQuarter;
                    const quarterSlice = historicalData.slice(start, end);
                    const quarterSum = quarterSlice.reduce((acc, entry) => acc + entry.price, 0);
                    const quarterAvg = quarterSum / quarterSlice.length;
                    
                    quarterlyData.push({
                        quarter: 4 - i,
                        average: quarterAvg
                    });
                }
                
                const quarterlyFairPrice = quarterlyData[0].average;
                const currentPrice = historicalData[historicalData.length - 1].price;

                // Calculate best selling price
                const historicalHigh = Math.max(...historicalData.map(item => item.price));
                const bestSellPrice = Math.max(
                    sma * coinSymbols[currentCoin].sellThreshold,
                    (historicalHigh + currentPrice) / 2 * 0.85
                );
                
                // Update UI
                document.getElementById('fairPrice').textContent = formatCurrency(sma);
                document.getElementById('quarterlyPrice').textContent = formatCurrency(quarterlyFairPrice);
                document.getElementById('bestSellPrice').textContent = formatCurrency(bestSellPrice);
                
                const now = new Date();
                document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleTimeString()}`;
                
                renderChart(historicalData, sma, quarterlyFairPrice, bestSellPrice);
                
                document.getElementById('statusText').textContent = 'Live data stream active';
                document.querySelector('.header h1').textContent = 
                    `${coinSymbols[currentCoin].symbol} Fair Price Calculator`;
                
            } catch (error) {
                console.error('Error fetching initial data:', error);
                document.getElementById('statusText').textContent = 'Error fetching initial data. Will retry...';
                setTimeout(fetchInitialData, 5000);
            }
        }

        async function changeCoin(coinId) {
            currentCoin = coinId;
            // Update quarterly info section
            const quarterlyInfo = document.querySelector('.quarterly-info');
            quarterlyInfo.innerHTML = `
                <h3>${coinDescriptions[coinId].title}</h3>
                <p>${coinDescriptions[coinId].description}</p>
            `;
            await fetchInitialData();
            initializeWebSocket(); // Reconnect WebSocket with new coin
        }

        function updatePriceComparison(currentPrice, fairPrice) {
            const comparisonEl = document.getElementById('priceComparison');
            const percentDiff = ((currentPrice - fairPrice) / fairPrice) * 100;
            const symbol = coinSymbols[currentCoin].symbol;
            
            if (percentDiff > 10) {
                comparisonEl.textContent = `${symbol} is currently ${Math.abs(percentDiff).toFixed(1)}% overvalued compared to the fair price.`;
                comparisonEl.className = 'comparison overvalued';
            } else if (percentDiff < -10) {
                comparisonEl.textContent = `${symbol} is currently ${Math.abs(percentDiff).toFixed(1)}% undervalued compared to the fair price.`;
                comparisonEl.className = 'comparison undervalued';
            } else {
                comparisonEl.textContent = `${symbol} is currently trading close to its fair price (${percentDiff.toFixed(1)}% difference).`;
                comparisonEl.className = 'comparison fair';
            }
        }
        
        function renderChart(priceData, smaValue, quarterlyValue, bestSellValue) {
            const ctx = document.getElementById('btcChart').getContext('2d');
            
            // Prepare data for chart
            const labels = priceData.map(entry => {
                const date = new Date(entry.timestamp);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            const prices = priceData.map(entry => entry.price);
            
            // Destroy previous chart if it exists
            if (btcChart) {
                btcChart.destroy();
            }
            
            // Create new chart
            btcChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${coinSymbols[currentCoin].symbol} Price (USD)`,
                            data: prices,
                            borderColor: '#ff6b00',
                            backgroundColor: 'rgba(255, 107, 0, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 0,
                            pointHoverRadius: 5
                        },
                        {
                            label: '200-Day SMA (Fair Price)',
                            data: Array(prices.length).fill(smaValue),
                            borderColor: '#2ecc71',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        },
                        {
                            label: 'Quarterly Fair Price',
                            data: Array(prices.length).fill(quarterlyValue),
                            borderColor: '#f39c12',
                            borderWidth: 2,
                            borderDash: [3, 3],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        },
                        {
                            label: 'Best Selling Price',
                            data: Array(prices.length).fill(bestSellValue),
                            borderColor: '#9b59b6',
                            borderWidth: 2,
                            borderDash: [2, 2],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                maxRotation: 0,
                                maxTicksLimit: 12
                            }
                        }
                    },
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: 'rgba(255, 107, 0, 0.3)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toLocaleString(undefined, {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        // Add this new function
        function toggleMethodology(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
            header.classList.toggle('active');
        }
    </script>
</body>
</html>
